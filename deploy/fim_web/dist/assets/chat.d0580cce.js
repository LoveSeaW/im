import{d as X,p as ue,b as Y,r as N,x as K,e as D,B as Q,c,g as e,w as s,f as t,m as p,y as B,S as ne,ak as ae,E as C,l as g,a,F as E,z as U,K as L,h as r,i as A,al as re,am as ie,an as le,u as ce,a9 as de,aa as _e,ab as pe,ao as W}from"./index.00362c69.js";import{s as me}from"./add_user_modal.edb5efa1.js";import{_ as G}from"./fim_avatar.vue_vue_type_style_index_0_lang.0abc880b.js";import{_ as ge,a as fe,b as he,c as ve,d as be,e as ye,f as ke}from"./fim_voice.vue_vue_type_style_index_0_lang.f499db3b.js";import{_ as De}from"./fim_event.vue_vue_type_script_setup_true_lang.1e9a9eb5.js";import"./search_dialog.vue_vue_type_style_index_0_lang.8710fe3f.js";import"./date.b8ea58a3.js";import"./event_store.c213d25a.js";import"./chat_api.69b5704f.js";import"./send_msg.d8fa9662.js";import"./file_api.3df89dab.js";const Ce={class:"fim_group_member"},Fe={class:"add_member_group_dialog"},$e={class:"dialog_left"},we=t("div",{class:"title"},"\u6211\u7684\u597D\u53CB",-1),Me={class:"dialog_right"},Ae=t("div",{class:"title"}," \u5DF2\u9009\u8054\u7CFB\u4EBA ",-1),Ie={class:"member_list"},xe={class:"item item_check"},Be=["onClick"],Le={class:"head"},Ee={class:"search"},Ne={class:"member_list"},Ve={class:"item"},ze={class:"icon"},Re={key:0,class:"iconfont icon-qunzhu"},Te={key:1,class:"iconfont icon-qunguanliyuan"},Pe={key:2,class:"iconfont icon-jinyan"},Se=X({__name:"group_member",props:{groupId:{}},setup(O){const i=ue(),d=Y(),_=O,m=N({list:[],count:0}),v=N({id:_.groupId,sort:"role asc",key:""});async function F(){v.id=_.groupId;let n=await re(v);m.list=n.data.list||[],m.count=n.data.count}K(()=>_.groupId,()=>{console.log(_.groupId),F()},{immediate:!0});const $=D(!1),h=N({id:_.groupId,memberIdList:[]}),w=D([]);async function T(){let n=await ae(_.groupId);if(n.code){C.error(n.msg);return}w.value=n.data.list,$.value=!0}const P=Q(()=>{const n=[];for(const l of w.value)h.memberIdList.includes(l.userId)&&n.push(l);return n});function V(n){const l=h.memberIdList.findIndex(k=>k===n);l!==-1&&h.memberIdList.splice(l,1)}async function S(){let n=await ie(h);if(n.code){C.error(n.msg);return}C.success("\u9080\u8BF7\u6210\u529F"),F(),u()}async function u(){h.memberIdList=[],$.value=!1}const f=Q(()=>m.list.filter(n=>n.isOnline).length),b=D();function I(){F()}function x(){b.value.focus()}function z(n){me({userID:n.userId,nickname:n.userNickname,abstract:"",avatar:n.avatar,isFriend:!1})}async function R(n,l){let k=await le({groupId:_.groupId,memberId:n.userId,prohibitionTime:l});if(k.code){C.error(k.msg);return}C.success("\u7981\u8A00\u8BBE\u7F6E\u6210\u529F")}function H(n,l){i.push({name:l,params:{id:n.userId}})}return(n,l)=>{const k=g("el-text"),Z=g("el-checkbox"),ee=g("el-checkbox-group"),q=g("el-scrollbar"),j=g("el-button"),oe=g("el-dialog"),te=g("el-input"),y=g("el-dropdown-item"),J=g("el-dropdown"),se=g("el-dropdown-menu");return a(),c("div",Ce,[e(oe,{width:"30%",title:"\u9080\u8BF7\u8FDB\u7FA4",modelValue:$.value,"onUpdate:modelValue":l[1]||(l[1]=o=>$.value=o)},{footer:s(()=>[e(j,{type:"primary",onClick:S},{default:s(()=>[p("\u786E\u5B9A")]),_:1}),e(j,{onClick:u},{default:s(()=>[p("\u53D6\u6D88")]),_:1})]),default:s(()=>[t("div",Fe,[t("div",$e,[we,e(q,{style:{"max-height":"350px"}},{default:s(()=>[e(ee,{modelValue:h.memberIdList,"onUpdate:modelValue":l[0]||(l[0]=o=>h.memberIdList=o),class:"member_list"},{default:s(()=>[(a(!0),c(E,null,U(w.value,o=>(a(),L(Z,{class:"item",value:o.userId,disabled:o.isInGroup},{default:s(()=>[e(G,{size:20,src:o.avatar},null,8,["src"]),e(k,{truncated:""},{default:s(()=>[p(B(o.nickname),1)]),_:2},1024)]),_:2},1032,["value","disabled"]))),256))]),_:1},8,["modelValue"])]),_:1})]),t("div",Me,[Ae,t("div",Ie,[e(q,{style:{"max-height":"350px"}},{default:s(()=>[(a(!0),c(E,null,U(P.value,o=>(a(),c("div",xe,[e(G,{size:20,src:o.avatar},null,8,["src"]),e(k,{truncated:""},{default:s(()=>[p(B(o.nickname),1)]),_:2},1024),t("i",{onClick:M=>V(o.userId),class:"iconfont icon-quxiao"},null,8,Be)]))),256))]),_:1})])])])]),_:1},8,["modelValue"]),t("div",Le,[t("span",null,[p("\u7FA4\u6210\u5458"),t("span",null,B(f.value)+"/"+B(m.list.length),1)]),t("span",null,[t("i",{onClick:T,class:"iconfont icon-add-group"}),t("i",{onClick:x,class:"iconfont icon-sousuo"})])]),t("div",Ee,[e(te,{ref_key:"searchIpt",ref:b,modelValue:v.key,"onUpdate:modelValue":l[2]||(l[2]=o=>v.key=o),onKeydown:ne(I,["enter"]),size:"small",placeholder:"\u641C\u7D22\u7FA4\u6210\u5458"},null,8,["modelValue"])]),t("div",Ne,[e(q,{style:{height:"100%"}},{default:s(()=>[(a(!0),c(E,null,U(m.list,o=>(a(),L(J,{trigger:"contextmenu"},{dropdown:s(()=>[e(se,null,{default:s(()=>[o.isFriend?(a(),c(E,{key:0},[e(y,{onClick:M=>H(o,"session_user_chat")},{default:s(()=>[p("\u79C1\u804A\u7528\u6237")]),_:2},1032,["onClick"]),e(y,{onClick:M=>H(o,"user_detail")},{default:s(()=>[p("\u7528\u6237\u8D44\u6599")]),_:2},1032,["onClick"])],64)):(a(),L(y,{key:1,onClick:M=>z(o)},{default:s(()=>[p("\u6DFB\u52A0\u597D\u53CB")]),_:2},1032,["onClick"])),!o.prohibitionTime&&(r(d).groupData.role===1&&o.role!==1||r(d).groupData.role===2&&o.role===3)?(a(),L(y,{key:2},{default:s(()=>[e(J,{trigger:"hover"},{dropdown:s(()=>[e(y,{onClick:M=>R(o,5)},{default:s(()=>[p("\u4E94\u5206\u949F")]),_:2},1032,["onClick"]),e(y,{onClick:M=>R(o,30)},{default:s(()=>[p("30\u5206\u949F")]),_:2},1032,["onClick"]),e(y,{onClick:M=>R(o,60)},{default:s(()=>[p("1\u5C0F\u65F6")]),_:2},1032,["onClick"])]),default:s(()=>[p(" \u7528\u6237\u7981\u8A00 ")]),_:2},1024)]),_:2},1024)):A("",!0),o.prohibitionTime&&(r(d).groupData.role===1&&o.role!==1||r(d).groupData.role===2&&o.role===3)?(a(),L(y,{key:3,onClick:M=>R(o)},{default:s(()=>[p(" \u53D6\u6D88\u7981\u8A00 ")]),_:2},1032,["onClick"])):A("",!0),e(y,{style:{color:"red"}},{default:s(()=>[p("\u8E22\u51FA\u7FA4\u804A")]),_:1})]),_:2},1024)]),default:s(()=>[t("div",Ve,[e(G,{online:o.isOnline,src:o.avatar},null,8,["online","src"]),e(k,{class:"name",truncated:"",style:{"max-width":"5rem"}},{default:s(()=>[p(B(o.userNickname),1)]),_:2},1024),t("div",ze,[o.role===1?(a(),c("i",Re)):o.role===2?(a(),c("i",Te)):A("",!0),o.prohibitionTime?(a(),c("i",Pe)):A("",!0)])])]),_:2},1024))),256))]),_:1})])])}}});const qe={class:"group_chat_inner"},Ue={class:"left"},Ge={class:"group_chat_body"},Ke={key:0,class:"more"},Oe={key:0,class:"group_chat_inner_action"},He={class:"icon"},je=t("span",null,"\u5220\u9664",-1),Je={class:"icon close_icon"},Qe={class:"group_msg_menu"},We={class:"group_msg_box"},Xe={key:0,class:"group_msg_tip"},Ye={key:0},Ze={key:1},eo={class:"right"},oo={class:"group_notice"},to=t("div",{class:"title"},"\u7FA4\u901A\u77E5",-1),so={class:"body"},fo=X({__name:"chat",setup(O){const i=Y(),d=ce();N({content:""});const _=D([]),m=N({id:0,limit:10,page:1});async function v(){m.id=Number(d.params.id),m.page=1;const f=(await W(m)).data.list||[];_.value=[];for(const b of f)_.value.push(F(b))}function F(u){return{id:u.id,user:{id:u.userID,nickName:u.userNickname,avatar:u.userAvatar},isMe:u.isMe,created_at:u.createdAt,msg:u.msg,msgPreview:u.msgPreview,showDate:u.showDate}}const $=D();K(()=>i.groupMsgData,()=>{var u;if(i.groupMsgData.msg.type===12){C.error((u=i.groupMsgData.msg.tipMsg)==null?void 0:u.content);return}if(i.groupMsgData.groupID===Number(d.params.id)){if(i.groupMsgData.msg.type===8){v();return}if(i.groupMsgData.id===0)return;_.value.push(F(i.groupMsgData)),setTimeout(()=>{const f=document.querySelector(".group_msg_body").clientHeight;$.value.setScrollTop(f)},100)}},{deep:!0}),K(()=>d.params,()=>{v()},{immediate:!0,deep:!0});const h=D(!1),w=D();function T(){var u;(u=w.value)==null||u.close(),h.value=!1}async function P(){var u;await((u=w.value)==null?void 0:u.chatDelete())&&v()}const V=D(!0);async function S(){m.id=Number(d.params.id),m.page=m.page+1;let u=await W(m);if(u.code){C.error(u.msg);return}if(_.value.length>=u.data.count){console.log("\u70B9\u5230\u5934\u4E86"),C.info("\u5DF2\u7ECF\u662F\u6700\u65E9\u7684\u6D88\u606F\u4E86"),V.value=!1;return}const f=u.data.list||[],b=[];for(const I of f||[]){const x=F(I);b.push(x)}_.value=[...b,..._.value]}return(u,f)=>{const b=g("el-scrollbar"),I=g("el-icon"),x=g("el-empty");return a(),c("div",qe,[t("div",Ue,[t("div",Ge,[e(b,{ref_key:"scrollbarRef",ref:$,height:"100%"},{default:s(()=>[t("div",{class:"group_msg_body",onMousedown:f[1]||(f[1]=de((...z)=>r(i).showMsgDateMethod&&r(i).showMsgDateMethod(...z),["middle","prevent"]))},[V.value?(a(),c("div",Ke,[t("span",{onClick:S},"\u52A0\u8F7D\u66F4\u591A")])):A("",!0),e(ye,{ref_key:"fimMsgListRef",ref:w,onCheckShow:f[0]||(f[0]=z=>h.value=!0),"show-nickname":"","msg-list":_.value,type:"group"},null,8,["msg-list"])],32)]),_:1},512)]),h.value?(a(),c("div",Oe,[t("div",He,[e(I,{onClick:P,size:20},{default:s(()=>[e(r(_e))]),_:1}),je]),t("div",Je,[e(I,{onClick:T,size:20},{default:s(()=>[e(r(pe))]),_:1})])])):(a(),c(E,{key:1},[t("div",Qe,[e(ke),e(ge,{id:Number(r(d).params.id),type:"group"},null,8,["id"]),e(fe,{id:Number(r(d).params.id),type:"group"},null,8,["id"]),e(he,{id:Number(r(d).params.id),type:"group"},null,8,["id"]),e(ve,{id:Number(r(d).params.id),type:"group"},null,8,["id"])]),t("div",We,[r(i).groupData.isProhibition&&r(i).groupData.role===3||r(i).groupData.prohibitionTime!=null?(a(),c("div",Xe,[r(i).groupData.isProhibition&&r(i).groupData.role===3?(a(),c("span",Ye,"\u5F53\u524D\u7FA4\u6B63\u5728\u5168\u5458\u7981\u8A00\u4E2D")):r(i).groupData.prohibitionTime!=null?(a(),c("span",Ze,"\u5F53\u524D\u7528\u6237\u6B63\u5728\u88AB\u7981\u8A00")):A("",!0)])):A("",!0),e(be,{id:Number(r(d).params.id),type:"group"},null,8,["id"])])],64))]),e(De,{"event-key":"history",onEvent:v}),t("div",eo,[t("div",oo,[to,t("div",so,[e(x,{description:"\u6682\u65E0\u901A\u77E5","image-size":50})])]),e(Se,{"group-id":Number(r(d).params.id)},null,8,["group-id"])])])}}});export{fo as default};
