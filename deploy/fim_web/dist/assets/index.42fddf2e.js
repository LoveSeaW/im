import{F as N}from"./fim_slide_head.002e8b79.js";import{_ as B}from"./fim_avatar.vue_vue_type_style_index_0_lang.0abc880b.js";import{r as L}from"./date.b8ea58a3.js";import{c as P,a as R}from"./chat_api.69b5704f.js";import{d as V,u as I,r as M,B as S,c as C,g as r,f as l,w as n,a3 as z,l as d,a as i,F as W,z as b,K as m,m as p,i as h,A as K,y,h as U,k as F,E as _,a4 as j}from"./index.00362c69.js";import{_ as q}from"./fim_event.vue_vue_type_script_setup_true_lang.1e9a9eb5.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./event_store.c213d25a.js";const G={class:"session_view"},H={class:"session_slide"},J={class:"session_list"},O=["onClick"],Q={class:"info"},X={class:"date"},Y={class:"session_main"},ue=V({__name:"index",setup(Z){const f=I(),w=M({list:[],count:0});async function v(){const e=await P(),a=await z(),t=[];for(const s of e.data.list)t.push({id:s.userId,title:s.nickname,avatar:s.avatar,date:s.created_at,msgPreview:s.msgPreview,isTop:s.isTop,type:"user"});for(const s of a.data.list)t.push({id:s.groupId,title:s.title,avatar:s.avatar,date:s.newMsgDate,msgPreview:s.newMsgPreview,isTop:s.isTop,type:"group"});const u=t.sort((s,c)=>s.isTop&&c.isTop?new Date(c.date).getTime()-new Date(s.date).getTime():s.isTop?-1:c.isTop?1:new Date(c.date).getTime()-new Date(s.date).getTime());w.list=u}function D(e){if(e.type==="user"){F.push({name:"session_user_chat",params:{id:e.id}});return}F.push({name:"session_group_chat",params:{id:e.id}})}const x=S(()=>e=>{const a={};a[e.type]=!0,a.isTop=e.isTop;const t=Number(f.params.id||"0");return f.path.startsWith("/group")&&e.type==="group"&&t===e.id&&(a.active=!0),f.path.startsWith("/user")&&e.type==="user"&&t===e.id&&(a.active=!0),a});v();function E(){if(f.name==="session_user_chat"){const e=Number(f.params.id);w.list.find(t=>t.type==="user"&&t.id===e)===void 0&&v()}}async function T(e,a){let t=await R(a);if(t.code){_.error(t.msg);return}e?_.success("\u7F6E\u9876\u7528\u6237\u6210\u529F"):_.success("\u53D6\u6D88\u7F6E\u9876\u7528\u6237\u6210\u529F"),v()}async function k(e,a){let t=await j(a,e);if(t.code){_.error(t.msg);return}e?_.success("\u7F6E\u9876\u7FA4\u6210\u529F"):_.success("\u53D6\u6D88\u7F6E\u9876\u7FA4\u6210\u529F"),v()}return(e,a)=>{const t=d("el-text"),u=d("el-dropdown-item"),s=d("el-dropdown-menu"),c=d("el-dropdown"),A=d("el-scrollbar"),$=d("router-view");return i(),C("div",G,[r(q,{"event-key":"sessionList",onEvent:E}),l("div",H,[r(N),r(A,{style:{height:"calc(100% - 40px)"}},{default:n(()=>[l("div",J,[(i(!0),C(W,null,b(w.list,o=>(i(),m(c,{trigger:"contextmenu"},{dropdown:n(()=>[r(s,null,{default:n(()=>[o.type==="user"&&!o.isTop?(i(),m(u,{key:0,onClick:g=>T(!0,o.id)},{default:n(()=>[p(" \u7F6E\u9876\u7528\u6237 ")]),_:2},1032,["onClick"])):h("",!0),o.type==="group"&&!o.isTop?(i(),m(u,{key:1,onClick:g=>k(!0,o.id)},{default:n(()=>[p(" \u7F6E\u9876\u7FA4 ")]),_:2},1032,["onClick"])):h("",!0),o.type==="user"&&o.isTop?(i(),m(u,{key:2,onClick:g=>T(!1,o.id)},{default:n(()=>[p(" \u53D6\u6D88\u7F6E\u9876 ")]),_:2},1032,["onClick"])):h("",!0),o.type==="group"&&o.isTop?(i(),m(u,{key:3,onClick:g=>k(!1,o.id)},{default:n(()=>[p(" \u53D6\u6D88\u7F6E\u9876 ")]),_:2},1032,["onClick"])):h("",!0)]),_:2},1024)]),default:n(()=>[l("div",{class:K(["item",x.value(o)]),onClick:g=>D(o)},[r(B,{shape:"circle",src:o.avatar},null,8,["src"]),l("div",Q,[r(t,{class:"title",truncated:"",style:{"max-width":"6rem"}},{default:n(()=>[p(y(o.title),1)]),_:2},1024),r(t,{class:"msg",truncated:""},{default:n(()=>[p(y(o.msgPreview),1)]),_:2},1024)]),l("div",X,y(U(L)(o.date)),1)],10,O)]),_:2},1024))),256))])]),_:1})]),l("div",Y,[r($)])])}}});export{ue as default};
